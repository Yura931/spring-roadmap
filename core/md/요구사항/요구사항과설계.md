# 비즈니스 요구사항과 설계


### 요구사항
> - 회원
>   - 회원을 가입하고 조회할 수 있다.
>   - 회원은 일반과 VIP 두 가지 등급이 있다.
>   - 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템과 연동할 수 있다.(미확정)
> - 주문과 할인 정책
>   - 회원은 상품을 주문할 수 있다.
>   - 회원 등급에 따라 할인 정책을 적용할 수 있다.
>   - 할인 정책은 모든 VIP는 100원을 할인해주는 고정 금액 할인을 적용해달라.(나중에 변경 될 수 있다.)
>   - 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고, 오픈 직전까지 고민을 미루고 싶다. 최악의 경우 할인을 적용하지 않을 수도 있다.(미확정)
>
> 요구사항을 보면 회원 데이터, 할인 정책 같은 부분은 지금 결정하기 어려운 부분이다.
> 그렇다고 이런 정책이 결정될 때 까지 개발을 무기한 기다릴 수 도 없다.
> 우리는 앞에서 배운 객체 지향 설계 방법이 있지 않은가!
> 
> 인터페이스를 만들고 구현체를 언제든지 갈아끼울 수 있도록 설계하면 된다.
>
> 스프링 없는 순수한 자바로만 개발을 진행!


### 회원 도메인 설계

> - 회원 도메인 협력 관계
>   - 클라이언트 -> 회원 서비스(회원가입, 회원조회) -> 회원 저장소(메모리 회원 저장소, DB 회원 저장소, 외부시스템 연동 회원 저장소)
> - 회원 클래스 다이어그램
> - 회원 객체 다이어그램
>   - 클라이언트 -> 회원 서비스 -> 메모리 회원 저장소


### 회원 도메인 개발 문제점


### 주문 도메인 협력, 역할, 책임
> 1. 주문 생성 : 클라이언트는 주문 서비스에 주문 생성을 요청한다.
> 2. 회원 조회 : 할인을 위해서는 회원등급이 필요하다. 그래서 주문 서비슨느 회원 저장소에서 회원을 조회한다.
> 3. 할인 적용 : 주문 서비스는 회원 등급에 따른 할인 여부를 할인 정책에 위임한다.
> 4. 주문 결과 반환 : 주문 서비스는 할인 결과를 포함한 주문 결과를 반환한다.


**[중요]역할들의 협력 관게를 그대로 재사용 할 수 있다!**


정률 할인으로 깔끔하게 바꿀 수 있는가!

애자일 소프트웨어 개발 선언  
서비스 오픈 직전에 할인 정책을 바꾸고 싶다!!

새로운 할인 적용과 문제점

어떻게 문제를 해결할 수 있을까?  
DIP를 위반하지 않도록 인터페이스에만 의존하도록 의존관계를 변경하면 됨


# 전체 흐름 정리
 
- 새로운 할인 정책 개발
- 새로운 할인 정책 적용과 문제점
- 관심사의 분리
- AppConfig 리팩터링
- 새로운 구조와 할인 정책 적용

### 새로운 할인 정책 개발
- 다형성 덕분에 새로운 정률 할인 정책 코드를 추가로 개발하는 것 자체는 아무 문제가 없음

### 새로운 할인 정책 적용과 문제점
- 새로 개발한 정률 할인 정책을 적용하려고 하니 클라이언트 코드인 주문 서비스 구현체도 함께 변경해야함  
- 주문 서비스 클라이언트가 인터페이스인`DiscountPolicy` 뿐만 아니라, `FixDiscountPolicy`도 함께 의존 -> **DIP 위반**  


### 관심사의 분리
- 애플리케이션을 하나의 공연으로 생각
- 기존에는 클라이언트가 의존하는 서버 구현 객체를 직접 생성하고, 실행함
- 비유를 하면 기존에는 남자 주인공 배우가 공연도 하고, 동시에 여자 주인공도 직접 초빙하는 다양한 책임을 가지고 있음
- 공연을 구성하고, 담당 배우를 섭외하고, 지정하는 책임을 담당하는 별도의 **공연 기획자**가 나올 시점
- 공연 기획자인 AppConfig가 등장
- AppConfig는 애플리케이션의 전체 동작 방식을 구성(config)하기 위해, **구현 객체를 생성**하고, **연결**하는 책임
- 이제부터 클라이언트 객체는 자신의 역할을 실행하는 것만 집중, 권한이 줄어듬(책임이 명확해짐)

### AppConfig 리팩터링
- 구성 정보에서 역할과 구현을 명확하게 분리
- 역할이 잘 들어남
- 중복 제거

### 새로운 구조와 할인 정책 적용
- 정액 할인 정책 -> 정률* 할인 정책으로 변경
- AppConfig의 등장으로 애플리케이션이 크게 *사용 영역*과, 객체를 생성하고 *구성(Configuration)하는 영역)*으로 분리
- 할인 정책을 변경해도 AppConfig가 있는 구성 영역만 변경하면 됨, 사용 영역은 변경할 필요가 없음. 물론 클라이언트 코드인 주문 서비스 코드도 변경하지 않음

 



